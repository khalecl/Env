<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ…Ø±ÙŠÙ† 2: Ù…ØµÙÙˆÙØ© Ù„ÙŠÙˆØ¨ÙˆÙ„Ø¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            margin-top: 20px;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00f260, #0575e6);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .content {
            padding: 30px;
        }

        .scenario {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.8s ease forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .matrix-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .matrix-title {
            color: #2c3e50;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: 200px repeat(5, 1fr);
            gap: 2px;
            background: #e3f2fd;
            border-radius: 10px;
            padding: 10px;
            overflow-x: auto;
            min-width: 100%;
        }

        .matrix-cell {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .matrix-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
            font-size: 11px;
        }

        .matrix-row-header {
            background: linear-gradient(135deg, #84fab0, #8fd3f4);
            color: #2c3e50;
            font-weight: bold;
            text-align: right;
            padding-right: 15px;
        }

        .impact-cell {
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
        }

        .impact-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .impact-cell.selected {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .impact-input {
            width: 40px;
            height: 30px;
            border: none;
            background: transparent;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            border-radius: 5px;
        }

        .impact-positive {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .impact-negative {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .impact-neutral {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .legend {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .legend h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .legend-items {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            display: none;
            text-align: center;
            color: #2c3e50;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .score-excellent { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .score-good { background: linear-gradient(135deg, #3498db, #2980b9); }
        .score-average { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .score-poor { background: linear-gradient(135deg, #e74c3c, #c0392b); }

        .feedback-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: right;
        }

        .critical-impacts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .impact-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-right: 4px solid;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .impact-negative-card { border-color: #e74c3c; }
        .impact-positive-card { border-color: #2ecc71; }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .matrix-grid {
                grid-template-columns: 150px repeat(5, 80px);
                font-size: 10px;
            }
            
            .matrix-cell {
                min-height: 50px;
                padding: 5px;
            }
            
            .legend-items {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ØªÙ…Ø±ÙŠÙ† 2: Ù…ØµÙÙˆÙØ© Ù„ÙŠÙˆØ¨ÙˆÙ„Ø¯</h1>
            <p>Exercise 2: Leopold Matrix Creation</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
        </div>

        <div class="content">
            <div class="scenario">
                <h3>ğŸ­ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ</h3>
                <p><strong>Ù…Ø´Ø±ÙˆØ¹:</strong> Ù…ØµÙ†Ø¹ Ø£Ø³Ù…Ù†Øª Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ø¨Ø®Ø²Ø§Ù…</p>
                <p><strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</strong> 40 Ù‡ÙƒØªØ§Ø± | <strong>Ø§Ù„Ø¥Ù†ØªØ§Ø¬:</strong> 800,000 Ø·Ù† Ø³Ù†ÙˆÙŠØ§Ù‹</p>
                <p><strong>Ø§Ù„Ø¹Ù…Ø§Ù„Ø©:</strong> 200 Ø¹Ø§Ù…Ù„ | <strong>Ø§Ù„ØªØ´ØºÙŠÙ„:</strong> 24 Ø³Ø§Ø¹Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹</p>
                <p><strong>Ù…Ù‡Ù…ØªÙƒ:</strong> Ù‚ÙŠÙ‘Ù… Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØµÙÙˆÙØ© Ù„ÙŠÙˆØ¨ÙˆÙ„Ø¯</p>
            </div>

            <div class="legend">
                <h4>ğŸ“‹ Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</h4>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #e74c3c, #c0392b);"></div>
                        <span>ØªØ£Ø«ÙŠØ± Ø³Ù„Ø¨ÙŠ: -10 Ø¥Ù„Ù‰ -1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ecf0f1;"></div>
                        <span>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ£Ø«ÙŠØ±: 0</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #2ecc71, #27ae60);"></div>
                        <span>ØªØ£Ø«ÙŠØ± Ø¥ÙŠØ¬Ø§Ø¨ÙŠ: +1 Ø¥Ù„Ù‰ +10</span>
                    </div>
                </div>
            </div>

            <div class="matrix-container">
                <div class="matrix-title">ğŸ¯ Ù…ØµÙÙˆÙØ© ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª</div>
                <div class="matrix-grid" id="matrixGrid">
                    <!-- Matrix will be generated by JavaScript -->
                </div>
            </div>

            <button class="submit-btn" id="submitBtn" onclick="calculateResults()" disabled>
                ğŸ“Š Ø§Ø­Ø³Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„
            </button>

            <div class="results" id="results">
                <div class="score-circle" id="scoreCircle">
                    <span id="scoreText">0%</span>
                </div>
                <h3 id="resultTitle">Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                <div class="feedback-section" id="feedback"></div>
            </div>
        </div>
    </div>

    <script>
        const activities = [
            'ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø±Ø¶',
            'ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù†',
            'Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
            'ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø¹Ù…Ø§Ù„',
            'ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª'
        ];

        const environmentalFactors = [
            'Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡',
            'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡',
            'ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„',
            'Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ±',
            'Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡',
            'Ø§Ù„Ù†ÙØ§ÙŠØ§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©'
        ];

        const correctAnswers = {
            '0-0': -6,  // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø±Ø¶ -> Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡
            '0-1': -5,  // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø±Ø¶ -> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡
            '0-2': +2,  // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø±Ø¶ -> ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„
            '0-3': -2,  // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø±Ø¶ -> Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ±
            '0-4': -3,  // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø±Ø¶ -> Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡
            '0-5': -4,  // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø±Ø¶ -> Ø§Ù„Ù†ÙØ§ÙŠØ§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©
            
            '1-0': -8,  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù† -> Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡
            '1-1': -7,  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù† -> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡
            '1-2': +7,  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù† -> ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„
            '1-3': -3,  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù† -> Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ±
            '1-4': -5,  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù† -> Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡
            '1-5': -6,  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù† -> Ø§Ù„Ù†ÙØ§ÙŠØ§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©
            
            '2-0': -4,  // Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -> Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡
            '2-1': -3,  // Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡
            '2-2': +3,  // Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -> ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„
            '2-3': -6,  // Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -> Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ±
            '2-4': 0,   // Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -> Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡
            '2-5': -2,  // Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -> Ø§Ù„Ù†ÙØ§ÙŠØ§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©
            
            '3-0': 0,   // ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø¹Ù…Ø§Ù„ -> Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡
            '3-1': 0,   // ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø¹Ù…Ø§Ù„ -> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡
            '3-2': +8,  // ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø¹Ù…Ø§Ù„ -> ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„
            '3-3': -2,  // ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø¹Ù…Ø§Ù„ -> Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ±
            '3-4': -1,  // ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø¹Ù…Ø§Ù„ -> Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡
            '3-5': -1,  // ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø¹Ù…Ø§Ù„ -> Ø§Ù„Ù†ÙØ§ÙŠØ§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©
            
            '4-0': -2,  // ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª -> Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡
            '4-1': -4,  // ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª -> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡
            '4-2': +2,  // ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª -> ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„
            '4-3': -1,  // ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª -> Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ±
            '4-4': -2,  // ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª -> Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡
            '4-5': -3   // ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª -> Ø§Ù„Ù†ÙØ§ÙŠØ§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©
        };

        let userAnswers = {};
        let totalCells = activities.length * environmentalFactors.length;

        function createMatrix() {
            const grid = document.getElementById('matrixGrid');
            
            // Empty cell for top-left corner
            const emptyCell = document.createElement('div');
            emptyCell.className = 'matrix-cell matrix-header';
            emptyCell.textContent = 'Ø§Ù„Ù†Ø´Ø§Ø· / Ø§Ù„Ø¹Ø§Ù…Ù„';
            grid.appendChild(emptyCell);

            // Activity headers
            activities.forEach(activity => {
                const cell = document.createElement('div');
                cell.className = 'matrix-cell matrix-header';
                cell.textContent = activity;
                grid.appendChild(cell);
            });

            // Environmental factors and impact cells
            environmentalFactors.forEach((factor, factorIndex) => {
                // Factor header
                const factorCell = document.createElement('div');
                factorCell.className = 'matrix-cell matrix-row-header';
                factorCell.textContent = factor;
                grid.appendChild(factorCell);

                // Impact cells for each activity
                activities.forEach((activity, activityIndex) => {
                    const impactCell = document.createElement('div');
                    impactCell.className = 'matrix-cell impact-cell';
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '-10';
                    input.max = '10';
                    input.className = 'impact-input';
                    input.placeholder = '0';
                    input.addEventListener('input', (e) => {
                        updateImpactCell(activityIndex, factorIndex, e.target.value, impactCell);
                    });
                    
                    impactCell.appendChild(input);
                    grid.appendChild(impactCell);
                });
            });
        }

        function updateImpactCell(activityIndex, factorIndex, value, cell) {
            const key = `${activityIndex}-${factorIndex}`;
            const numValue = parseInt(value) || 0;
            
            userAnswers[key] = numValue;
            
            // Update cell appearance
            cell.classList.remove('impact-positive', 'impact-negative', 'impact-neutral');
            if (numValue > 0) {
                cell.classList.add('impact-positive');
            } else if (numValue < 0) {
                cell.classList.add('impact-negative');
            } else {
                cell.classList.add('impact-neutral');
            }
            
            // Update progress
            updateProgress();
            
            // Check if all cells filled
            if (Object.keys(userAnswers).length === totalCells) {
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtn').classList.add('pulse');
            }
        }

        function updateProgress() {
            const progress = (Object.keys(userAnswers).length / totalCells) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function calculateResults() {
            let totalScore = 0;
            let correctCount = 0;
            let criticalMisses = [];
            
            for (let key in correctAnswers) {
                const userValue = userAnswers[key] || 0;
                const correctValue = correctAnswers[key];
                
                // Calculate accuracy (tolerance of Â±2 for close answers)
                const difference = Math.abs(userValue - correctValue);
                if (difference === 0) {
                    totalScore += 10; // Perfect match
                    correctCount++;
                } else if (difference <= 2) {
                    totalScore += 7; // Close match
                } else if (difference <= 4) {
                    totalScore += 4; // Acceptable range
                } else {
                    // Major miss - check if it's a critical impact
                    if (Math.abs(correctValue) >= 6) {
                        criticalMisses.push({
                            key: key,
                            activity: activities[parseInt(key.split('-')[0])],
                            factor: environmentalFactors[parseInt(key.split('-')[1])],
                            userValue: userValue,
                            correctValue: correctValue
                        });
                    }
                }
            }
            
            const finalScore = Math.round((totalScore / (totalCells * 10)) * 100);
            displayResults(finalScore, correctCount, criticalMisses);
        }

        function displayResults(score, correctCount, criticalMisses) {
            const resultsDiv = document.getElementById('results');
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreText = document.getElementById('scoreText');
            const resultTitle = document.getElementById('resultTitle');
            const feedbackDiv = document.getElementById('feedback');

            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });

            // Animate score
            let currentScore = 0;
            const targetScore = score;
            const increment = targetScore / 50;

            const scoreAnimation = setInterval(() => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(scoreAnimation);
                }
                scoreText.textContent = Math.round(currentScore) + '%';
            }, 20);

            // Set score circle color and title
            scoreCircle.classList.remove('score-excellent', 'score-good', 'score-average', 'score-poor');
            
            if (score >= 85) {
                scoreCircle.classList.add('score-excellent');
                resultTitle.textContent = 'ğŸŒŸ Ù…Ù…ØªØ§Ø²! ÙÙ‡Ù… Ø¹Ù…ÙŠÙ‚ Ù„Ù…ØµÙÙˆÙØ© Ù„ÙŠÙˆØ¨ÙˆÙ„Ø¯';
            } else if (score >= 70) {
                scoreCircle.classList.add('score-good');
                resultTitle.textContent = 'ğŸ‘ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! ØªÙ‚ÙŠÙŠÙ… ØµØ­ÙŠØ­ Ù„Ù„ØªØ£Ø«ÙŠØ±Ø§Øª';
            } else if (score >= 50) {
                scoreCircle.classList.add('score-average');
                resultTitle.textContent = 'âš ï¸ Ù…ØªÙˆØ³Ø·! ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† ÙÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…';
            } else {
                scoreCircle.classList.add('score-poor');
                resultTitle.textContent = 'ğŸ”„ ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…ÙØ§Ù‡ÙŠÙ…';
            }

            // Generate feedback
            let feedbackHTML = `
                <h4>ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡:</h4>
                <p>Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©: <strong>${correctCount}</strong> Ù…Ù† Ø£ØµÙ„ <strong>${totalCells}</strong></p>
                <p>Ø¯Ù‚Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: <strong>${score}%</strong></p>
            `;

            // Show critical impacts (correct answers)
            feedbackHTML += `
                <h4>ğŸ¯ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</h4>
                <div class="critical-impacts">
                    <div class="impact-card impact-negative-card">
                        <strong>ğŸ”´ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù† â†’ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡: -8</strong>
                        <p>Ø£ÙƒØ¨Ø± ØªØ£Ø«ÙŠØ± Ø³Ù„Ø¨ÙŠ - Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª Ù…Ø³ØªÙ…Ø±Ø©</p>
                    </div>
                    <div class="impact-card impact-negative-card">
                        <strong>ğŸ”´ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙØ±Ø§Ù† â†’ Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡: -7</strong>
                        <p>ØªØ´ØºÙŠÙ„ 24 Ø³Ø§Ø¹Ø© ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙƒØ§Ù†</p>
                    </div>
                    <div class="impact-card impact-positive-card">
                        <strong>ğŸŸ¢ ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø¹Ù…Ø§Ù„ â†’ ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„: +8</strong>
                        <p>Ø£ÙƒØ¨Ø± ÙØ§Ø¦Ø¯Ø© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© ÙˆØ§Ù‚ØªØµØ§Ø¯ÙŠØ©</p>
                    </div>
                    <div class="impact-card impact-negative-card">
                        <strong>ğŸ”´ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª â†’ Ø§Ù„Ù…Ø±ÙˆØ±: -6</strong>
                        <p>50 Ø´Ø§Ø­Ù†Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±Ù‚</p>
                    </div>
                </div>
            `;

            if (criticalMisses.length > 0) {
                feedbackHTML += '<h4>âš ï¸ ØªØ£Ø«ÙŠØ±Ø§Øª Ù…Ù‡Ù…Ø© ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©:</h4>';
                criticalMisses.forEach(miss => {
                    feedbackHTML += `
                        <div style="background: #fff3cd; padding: 15px; margin: 10px 0; border-radius: 10px;">
                            <strong>${miss.activity} â†’ ${miss.factor}</strong><br>
                            Ø¥Ø¬Ø§Ø¨ØªÙƒ: <span style="color: #856404;">${miss.userValue}</span> | 
                            Ø§Ù„ØµØ­ÙŠØ­: <span style="color: #155724;"><strong>${miss.correctValue}</strong></span>
                        </div>
                    `;
                });
            }

            feedbackHTML += `
                <div style="background: #d1ecf1; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="color: #0c5460;">ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ­Ø³ÙŠÙ†:</h4>
                    <ul style="text-align: right; color: #0c5460;">
                        <li>Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© (24 Ø³Ø§Ø¹Ø©) Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø¤Ù‚ØªØ©</li>
                        <li>Ø§Ù„Ù‚Ø±Ø¨ Ù…Ù† Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø³ÙƒÙ†ÙŠØ© ÙŠØ²ÙŠØ¯ Ø£Ù‡Ù…ÙŠØ© Ø§Ù„ØªØ£Ø«ÙŠØ±</li>
                        <li>Ø­Ø¬Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (800,000 Ø·Ù†) ÙŠØ¹Ù†ÙŠ ØªØ£Ø«ÙŠØ±Ø§Øª ÙƒØ¨ÙŠØ±Ø©</li>
                        <li>ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„ ØªØ£Ø«ÙŠØ± Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ù…Ù‡Ù… ÙÙŠ Ø±Ø£Ø³ Ø§Ù„Ø®ÙŠÙ…Ø©</li>
                    </ul>
                </div>
            `;

            feedbackDiv.innerHTML = feedbackHTML;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createMatrix();
        });
    </script>
</body>
</html>
