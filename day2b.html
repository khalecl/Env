<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ™ŸÖÿ±ŸäŸÜ 2: ŸÖÿµŸÅŸàŸÅÿ© ŸÑŸäŸàÿ®ŸàŸÑÿØ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            margin-top: 20px;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00f260, #0575e6);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .content {
            padding: 30px;
        }

        .scenario {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.8s ease forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .matrix-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .matrix-title {
            color: #2c3e50;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: 200px repeat(5, 1fr);
            gap: 2px;
            background: #e3f2fd;
            border-radius: 10px;
            padding: 10px;
            overflow-x: auto;
            min-width: 100%;
        }

        .matrix-cell {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .matrix-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
            font-size: 11px;
        }

        .matrix-row-header {
            background: linear-gradient(135deg, #84fab0, #8fd3f4);
            color: #2c3e50;
            font-weight: bold;
            text-align: right;
            padding-right: 15px;
        }

        .impact-cell {
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
        }

        .impact-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .impact-cell.selected {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .impact-input {
            width: 40px;
            height: 30px;
            border: none;
            background: transparent;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            border-radius: 5px;
        }

        .impact-positive {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .impact-negative {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .impact-neutral {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .legend {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .legend h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .legend-items {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            padding: 30px;
            border-radius: 20px;
            margin-top: 30px;
            display: none;
            text-align: center;
            color: #2c3e50;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .score-excellent { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .score-good { background: linear-gradient(135deg, #3498db, #2980b9); }
        .score-average { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .score-poor { background: linear-gradient(135deg, #e74c3c, #c0392b); }

        .feedback-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: right;
        }

        .critical-impacts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .impact-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-right: 4px solid;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .impact-negative-card { border-color: #e74c3c; }
        .impact-positive-card { border-color: #2ecc71; }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .matrix-grid {
                grid-template-columns: 150px repeat(5, 80px);
                font-size: 10px;
            }
            
            .matrix-cell {
                min-height: 50px;
                padding: 5px;
            }
            
            .legend-items {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä ÿ™ŸÖÿ±ŸäŸÜ 2: ŸÖÿµŸÅŸàŸÅÿ© ŸÑŸäŸàÿ®ŸàŸÑÿØ</h1>
            <p>Exercise 2: Leopold Matrix Creation</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
        </div>

        <div class="content">
            <div class="scenario">
                <h3>üè≠ ÿßŸÑÿ≥ŸäŸÜÿßÿ±ŸäŸà</h3>
                <p><strong>ŸÖÿ¥ÿ±Ÿàÿπ:</strong> ŸÖÿµŸÜÿπ ÿ£ÿ≥ŸÖŸÜÿ™ ÿ¨ÿØŸäÿØ ŸÅŸä ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿµŸÜÿßÿπŸäÿ© ÿ®ÿÆÿ≤ÿßŸÖ</p>
                <p><strong>ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©:</strong> 40 ŸáŸÉÿ™ÿßÿ± | <strong>ÿßŸÑÿ•ŸÜÿ™ÿßÿ¨:</strong> 800,000 ÿ∑ŸÜ ÿ≥ŸÜŸàŸäÿßŸã</p>
                <p><strong>ÿßŸÑÿπŸÖÿßŸÑÿ©:</strong> 200 ÿπÿßŸÖŸÑ | <strong>ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ:</strong> 24 ÿ≥ÿßÿπÿ© ŸäŸàŸÖŸäÿßŸã</p>
                <p><strong>ŸÖŸáŸÖÿ™ŸÉ:</strong> ŸÇŸäŸëŸÖ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®Ÿäÿ¶Ÿäÿ© ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖÿµŸÅŸàŸÅÿ© ŸÑŸäŸàÿ®ŸàŸÑÿØ</p>
            </div>

            <div class="legend">
                <h4>üìã ŸÖŸÇŸäÿßÿ≥ ÿßŸÑÿ™ŸÇŸäŸäŸÖ:</h4>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #e74c3c, #c0392b);"></div>
                        <span>ÿ™ÿ£ÿ´Ÿäÿ± ÿ≥ŸÑÿ®Ÿä: -10 ÿ•ŸÑŸâ -1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ecf0f1;"></div>
                        <span>ŸÑÿß ŸäŸàÿ¨ÿØ ÿ™ÿ£ÿ´Ÿäÿ±: 0</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #2ecc71, #27ae60);"></div>
                        <span>ÿ™ÿ£ÿ´Ÿäÿ± ÿ•Ÿäÿ¨ÿßÿ®Ÿä: +1 ÿ•ŸÑŸâ +10</span>
                    </div>
                </div>
            </div>

            <div class="matrix-container">
                <div class="matrix-title">üéØ ŸÖÿµŸÅŸàŸÅÿ© ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™</div>
                <div class="matrix-grid" id="matrixGrid">
                    <!-- Matrix will be generated by JavaScript -->
                </div>
            </div>

            <button class="submit-btn" id="submitBtn" onclick="calculateResults()" disabled>
                üìä ÿßÿ≠ÿ≥ÿ® ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ŸàÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ
            </button>

            <div class="results" id="results">
                <div class="score-circle" id="scoreCircle">
                    <span id="scoreText">0%</span>
                </div>
                <h3 id="resultTitle">ŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ™ŸÇŸäŸäŸÖ</h3>
                <div class="feedback-section" id="feedback"></div>
            </div>
        </div>
    </div>

    <script>
        const activities = [
            'ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ∂',
            'ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ',
            'ŸÜŸÇŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™',
            'ÿ™Ÿàÿ∏ŸäŸÅ ÿßŸÑÿπŸÖÿßŸÑ',
            'ÿµŸäÿßŸÜÿ© ÿßŸÑŸÖÿπÿØÿßÿ™'
        ];

        const environmentalFactors = [
            'ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°',
            'ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∂Ÿàÿ∂ÿßÿ°',
            'ŸÅÿ±ÿµ ÿßŸÑÿπŸÖŸÑ',
            'ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿ±Ÿàÿ±',
            'ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑŸÖŸäÿßŸá',
            'ÿßŸÑŸÜŸÅÿßŸäÿßÿ™ ÿßŸÑÿµŸÜÿßÿπŸäÿ©'
        ];

        const correctAnswers = {
            '0-0': -6,  // ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ∂ -> ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°
            '0-1': -5,  // ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ∂ -> ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∂Ÿàÿ∂ÿßÿ°
            '0-2': +2,  // ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ∂ -> ŸÅÿ±ÿµ ÿßŸÑÿπŸÖŸÑ
            '0-3': -2,  // ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ∂ -> ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
            '0-4': -3,  // ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ∂ -> ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑŸÖŸäÿßŸá
            '0-5': -4,  // ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ∂ -> ÿßŸÑŸÜŸÅÿßŸäÿßÿ™ ÿßŸÑÿµŸÜÿßÿπŸäÿ©
            
            '1-0': -8,  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ -> ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°
            '1-1': -7,  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ -> ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∂Ÿàÿ∂ÿßÿ°
            '1-2': +7,  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ -> ŸÅÿ±ÿµ ÿßŸÑÿπŸÖŸÑ
            '1-3': -3,  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ -> ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
            '1-4': -5,  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ -> ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑŸÖŸäÿßŸá
            '1-5': -6,  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ -> ÿßŸÑŸÜŸÅÿßŸäÿßÿ™ ÿßŸÑÿµŸÜÿßÿπŸäÿ©
            
            '2-0': -4,  // ŸÜŸÇŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ -> ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°
            '2-1': -3,  // ŸÜŸÇŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ -> ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∂Ÿàÿ∂ÿßÿ°
            '2-2': +3,  // ŸÜŸÇŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ -> ŸÅÿ±ÿµ ÿßŸÑÿπŸÖŸÑ
            '2-3': -6,  // ŸÜŸÇŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ -> ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
            '2-4': 0,   // ŸÜŸÇŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ -> ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑŸÖŸäÿßŸá
            '2-5': -2,  // ŸÜŸÇŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ -> ÿßŸÑŸÜŸÅÿßŸäÿßÿ™ ÿßŸÑÿµŸÜÿßÿπŸäÿ©
            
            '3-0': 0,   // ÿ™Ÿàÿ∏ŸäŸÅ ÿßŸÑÿπŸÖÿßŸÑ -> ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°
            '3-1': 0,   // ÿ™Ÿàÿ∏ŸäŸÅ ÿßŸÑÿπŸÖÿßŸÑ -> ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∂Ÿàÿ∂ÿßÿ°
            '3-2': +8,  // ÿ™Ÿàÿ∏ŸäŸÅ ÿßŸÑÿπŸÖÿßŸÑ -> ŸÅÿ±ÿµ ÿßŸÑÿπŸÖŸÑ
            '3-3': -2,  // ÿ™Ÿàÿ∏ŸäŸÅ ÿßŸÑÿπŸÖÿßŸÑ -> ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
            '3-4': -1,  // ÿ™Ÿàÿ∏ŸäŸÅ ÿßŸÑÿπŸÖÿßŸÑ -> ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑŸÖŸäÿßŸá
            '3-5': -1,  // ÿ™Ÿàÿ∏ŸäŸÅ ÿßŸÑÿπŸÖÿßŸÑ -> ÿßŸÑŸÜŸÅÿßŸäÿßÿ™ ÿßŸÑÿµŸÜÿßÿπŸäÿ©
            
            '4-0': -2,  // ÿµŸäÿßŸÜÿ© ÿßŸÑŸÖÿπÿØÿßÿ™ -> ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°
            '4-1': -4,  // ÿµŸäÿßŸÜÿ© ÿßŸÑŸÖÿπÿØÿßÿ™ -> ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∂Ÿàÿ∂ÿßÿ°
            '4-2': +2,  // ÿµŸäÿßŸÜÿ© ÿßŸÑŸÖÿπÿØÿßÿ™ -> ŸÅÿ±ÿµ ÿßŸÑÿπŸÖŸÑ
            '4-3': -1,  // ÿµŸäÿßŸÜÿ© ÿßŸÑŸÖÿπÿØÿßÿ™ -> ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
            '4-4': -2,  // ÿµŸäÿßŸÜÿ© ÿßŸÑŸÖÿπÿØÿßÿ™ -> ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑŸÖŸäÿßŸá
            '4-5': -3   // ÿµŸäÿßŸÜÿ© ÿßŸÑŸÖÿπÿØÿßÿ™ -> ÿßŸÑŸÜŸÅÿßŸäÿßÿ™ ÿßŸÑÿµŸÜÿßÿπŸäÿ©
        };

        let userAnswers = {};
        let totalCells = activities.length * environmentalFactors.length;

        function createMatrix() {
            const grid = document.getElementById('matrixGrid');
            
            // Empty cell for top-left corner
            const emptyCell = document.createElement('div');
            emptyCell.className = 'matrix-cell matrix-header';
            emptyCell.textContent = 'ÿßŸÑŸÜÿ¥ÿßÿ∑ / ÿßŸÑÿπÿßŸÖŸÑ';
            grid.appendChild(emptyCell);

            // Activity headers
            activities.forEach(activity => {
                const cell = document.createElement('div');
                cell.className = 'matrix-cell matrix-header';
                cell.textContent = activity;
                grid.appendChild(cell);
            });

            // Environmental factors and impact cells
            environmentalFactors.forEach((factor, factorIndex) => {
                // Factor header
                const factorCell = document.createElement('div');
                factorCell.className = 'matrix-cell matrix-row-header';
                factorCell.textContent = factor;
                grid.appendChild(factorCell);

                // Impact cells for each activity
                activities.forEach((activity, activityIndex) => {
                    const impactCell = document.createElement('div');
                    impactCell.className = 'matrix-cell impact-cell';
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '-10';
                    input.max = '10';
                    input.className = 'impact-input';
                    input.placeholder = '0';
                    input.addEventListener('input', (e) => {
                        updateImpactCell(activityIndex, factorIndex, e.target.value, impactCell);
                    });
                    
                    impactCell.appendChild(input);
                    grid.appendChild(impactCell);
                });
            });
        }

        function updateImpactCell(activityIndex, factorIndex, value, cell) {
            const key = `${activityIndex}-${factorIndex}`;
            const numValue = parseInt(value) || 0;
            
            userAnswers[key] = numValue;
            
            // Update cell appearance
            cell.classList.remove('impact-positive', 'impact-negative', 'impact-neutral');
            if (numValue > 0) {
                cell.classList.add('impact-positive');
            } else if (numValue < 0) {
                cell.classList.add('impact-negative');
            } else {
                cell.classList.add('impact-neutral');
            }
            
            // Update progress
            updateProgress();
            
            // Check if all cells filled
            if (Object.keys(userAnswers).length === totalCells) {
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtn').classList.add('pulse');
            }
        }

        function updateProgress() {
            const progress = (Object.keys(userAnswers).length / totalCells) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function calculateResults() {
            let totalScore = 0;
            let correctCount = 0;
            let criticalMisses = [];
            
            for (let key in correctAnswers) {
                const userValue = userAnswers[key] || 0;
                const correctValue = correctAnswers[key];
                
                // Calculate accuracy (tolerance of ¬±2 for close answers)
                const difference = Math.abs(userValue - correctValue);
                if (difference === 0) {
                    totalScore += 10; // Perfect match
                    correctCount++;
                } else if (difference <= 2) {
                    totalScore += 7; // Close match
                } else if (difference <= 4) {
                    totalScore += 4; // Acceptable range
                } else {
                    // Major miss - check if it's a critical impact
                    if (Math.abs(correctValue) >= 6) {
                        criticalMisses.push({
                            key: key,
                            activity: activities[parseInt(key.split('-')[0])],
                            factor: environmentalFactors[parseInt(key.split('-')[1])],
                            userValue: userValue,
                            correctValue: correctValue
                        });
                    }
                }
            }
            
            const finalScore = Math.round((totalScore / (totalCells * 10)) * 100);
            displayResults(finalScore, correctCount, criticalMisses);
        }

        function displayResults(score, correctCount, criticalMisses) {
            const resultsDiv = document.getElementById('results');
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreText = document.getElementById('scoreText');
            const resultTitle = document.getElementById('resultTitle');
            const feedbackDiv = document.getElementById('feedback');

            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });

            // Animate score
            let currentScore = 0;
            const targetScore = score;
            const increment = targetScore / 50;

            const scoreAnimation = setInterval(() => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(scoreAnimation);
                }
                scoreText.textContent = Math.round(currentScore) + '%';
            }, 20);

            // Set score circle color and title
            scoreCircle.classList.remove('score-excellent', 'score-good', 'score-average', 'score-poor');
            
            if (score >= 85) {
                scoreCircle.classList.add('score-excellent');
                resultTitle.textContent = 'üåü ŸÖŸÖÿ™ÿßÿ≤! ŸÅŸáŸÖ ÿπŸÖŸäŸÇ ŸÑŸÖÿµŸÅŸàŸÅÿ© ŸÑŸäŸàÿ®ŸàŸÑÿØ';
            } else if (score >= 70) {
                scoreCircle.classList.add('score-good');
                resultTitle.textContent = 'üëç ÿ¨ŸäÿØ ÿ¨ÿØÿßŸã! ÿ™ŸÇŸäŸäŸÖ ÿµÿ≠Ÿäÿ≠ ŸÑŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™';
            } else if (score >= 50) {
                scoreCircle.classList.add('score-average');
                resultTitle.textContent = '‚ö†Ô∏è ŸÖÿ™Ÿàÿ≥ÿ∑! Ÿäÿ≠ÿ™ÿßÿ¨ ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÅŸä ÿßŸÑÿ™ŸÇŸäŸäŸÖ';
            } else {
                scoreCircle.classList.add('score-poor');
                resultTitle.textContent = 'üîÑ Ÿäÿ≠ÿ™ÿßÿ¨ ŸÖÿ±ÿßÿ¨ÿπÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÑŸÖŸÅÿßŸáŸäŸÖ';
            }

            // Generate feedback
            let feedbackHTML = `
                <h4>üìä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿØÿßÿ°:</h4>
                <p>ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿµÿ≠Ÿäÿ≠ÿ©: <strong>${correctCount}</strong> ŸÖŸÜ ÿ£ÿµŸÑ <strong>${totalCells}</strong></p>
                <p>ÿØŸÇÿ© ÿßŸÑÿ™ŸÇŸäŸäŸÖ: <strong>${score}%</strong></p>
            `;

            // Show critical impacts (correct answers)
            feedbackHTML += `
                <h4>üéØ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ±ÿ¨ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©:</h4>
                <div class="critical-impacts">
                    <div class="impact-card impact-negative-card">
                        <strong>üî¥ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ ‚Üí ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°: -8</strong>
                        <p>ÿ£ŸÉÿ®ÿ± ÿ™ÿ£ÿ´Ÿäÿ± ÿ≥ŸÑÿ®Ÿä - ÿßŸÜÿ®ÿπÿßÿ´ÿßÿ™ ŸÖÿ≥ÿ™ŸÖÿ±ÿ©</p>
                    </div>
                    <div class="impact-card impact-negative-card">
                        <strong>üî¥ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ŸÅÿ±ÿßŸÜ ‚Üí ÿßŸÑÿ∂Ÿàÿ∂ÿßÿ°: -7</strong>
                        <p>ÿ™ÿ¥ÿ∫ŸäŸÑ 24 ÿ≥ÿßÿπÿ© Ÿäÿ§ÿ´ÿ± ÿπŸÑŸâ ÿßŸÑÿ≥ŸÉÿßŸÜ</p>
                    </div>
                    <div class="impact-card impact-positive-card">
                        <strong>üü¢ ÿ™Ÿàÿ∏ŸäŸÅ ÿßŸÑÿπŸÖÿßŸÑ ‚Üí ŸÅÿ±ÿµ ÿßŸÑÿπŸÖŸÑ: +8</strong>
                        <p>ÿ£ŸÉÿ®ÿ± ŸÅÿßÿ¶ÿØÿ© ÿßÿ¨ÿ™ŸÖÿßÿπŸäÿ© ŸàÿßŸÇÿ™ÿµÿßÿØŸäÿ©</p>
                    </div>
                    <div class="impact-card impact-negative-card">
                        <strong>üî¥ ŸÜŸÇŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ‚Üí ÿßŸÑŸÖÿ±Ÿàÿ±: -6</strong>
                        <p>50 ÿ¥ÿßÿ≠ŸÜÿ© ŸäŸàŸÖŸäÿßŸã ÿ™ÿ§ÿ´ÿ± ÿπŸÑŸâ ÿßŸÑÿ∑ÿ±ŸÇ</p>
                    </div>
                </div>
            `;

            if (criticalMisses.length > 0) {
                feedbackHTML += '<h4>‚ö†Ô∏è ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÖŸáŸÖÿ© ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÖÿ±ÿßÿ¨ÿπÿ©:</h4>';
                criticalMisses.forEach(miss => {
                    feedbackHTML += `
                        <div style="background: #fff3cd; padding: 15px; margin: 10px 0; border-radius: 10px;">
                            <strong>${miss.activity} ‚Üí ${miss.factor}</strong><br>
                            ÿ•ÿ¨ÿßÿ®ÿ™ŸÉ: <span style="color: #856404;">${miss.userValue}</span> | 
                            ÿßŸÑÿµÿ≠Ÿäÿ≠: <span style="color: #155724;"><strong>${miss.correctValue}</strong></span>
                        </div>
                    `;
                });
            }

            feedbackHTML += `
                <div style="background: #d1ecf1; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="color: #0c5460;">üí° ŸÜÿµÿßÿ¶ÿ≠ ŸÑŸÑÿ™ÿ≠ÿ≥ŸäŸÜ:</h4>
                    <ul style="text-align: right; color: #0c5460;">
                        <li>ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸÖÿ±ÿ© (24 ÿ≥ÿßÿπÿ©) ÿ£ŸÉÿ®ÿ± ŸÖŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©</li>
                        <li>ÿßŸÑŸÇÿ±ÿ® ŸÖŸÜ ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑÿ≥ŸÉŸÜŸäÿ© Ÿäÿ≤ŸäÿØ ÿ£ŸáŸÖŸäÿ© ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±</li>
                        <li>ÿ≠ÿ¨ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ (800,000 ÿ∑ŸÜ) ŸäÿπŸÜŸä ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÉÿ®Ÿäÿ±ÿ©</li>
                        <li>ŸÅÿ±ÿµ ÿßŸÑÿπŸÖŸÑ ÿ™ÿ£ÿ´Ÿäÿ± ÿ•Ÿäÿ¨ÿßÿ®Ÿä ŸÖŸáŸÖ ŸÅŸä ÿ±ÿ£ÿ≥ ÿßŸÑÿÆŸäŸÖÿ©</li>
                    </ul>
                </div>
            `;

            feedbackDiv.innerHTML = feedbackHTML;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createMatrix();
        });
    </script>
</body>
</html>
